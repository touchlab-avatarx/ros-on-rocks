# 🚀 Touchlab ROS Docker Setup Guide

Welcome to the ROS Docker Setup! This guide will help you set up, run, and manage ROS services inside Docker containers using Docker Compose. Everything is designed to be modular, reusable, and easy to configure. (Hopefullly, suggestions are welcome.)


## 📌 Prerequisites

Before running this setup, ensure you have the following installed on your machine:

#### 1️⃣ Install Docker

* Follow Docker Installation Guide to install Docker.

#### 2️⃣ Install Docker Compose
* [Docker Compose](https://docs.docker.com/compose/install/linux/#install-using-the-repository) allows you to manage multi-container applications.

#### 3️⃣ Introsepection (Optional)
* Install [lazydocker](https://github.com/jesseduffield/lazydocker) 

#### 📂 Project Structure

This section explains how the files and directories should be organised.

```graphql
workspace/
│── launch.sh                  # Main script to manage services
│── services.yml                 # Defines all ROS services
│── .devcontainer/               # Folder for Docker-related files
│   ├── Dockerfile               # Docker build file
│   ├── image.yml                # ROS image build configurations
│   ├── dev.yml                  # dev service configurations (used by vscode)
│   ├── devcontainer.json        # vscode specific configuration
│   ├── build-devcontainer.yml   # simple script used by devcontainer.josn to build image from image.yml
│   │── .env                     # Environment configuration file (🔧 UPDATE THIS!)
│   │── source.bash              # Bashrc additions for docker services  
│── src/                         # Directory for all ROS packages
│   ├── launcher/                # (🔧 ADD THIS!) while setting up environment
│   ├   ├──services.yml          # Compose file for all ros services launch
    ├   ├──launch.sh             # Helper script to start stop containers
│   ├── package2/
│   ├── package3/
```


### 🚀 SETUP

## 📝 Step 1: Configure the .env File (.devcontainer/.env)

This will be generated by `build-devcontainer.sh` first time it's called.
If you need to update the values in the file, delete `.env` and re-run the script.

To pass GIT identity to the docker, make sure you set up your `.bashrc` on the host system with these variables and replace the name and email with your details:
```
GIT_COMMITTER_NAME=yourname
GIT_COMMITTER_EMAIL=you@example.com
GIT_AUTHOR_NAME=yourname
GIT_AUTHOR_EMAIL=you@example.com
```

## 📝 Step 2: Add ROS Services in `services.yml`

All ROS services are defined in services.yml.
🔧 Example: Adding ROS Services 

```yaml
x-common-parameters: &common-parameters
  image: ros_image
  restart: unless-stopped
  network_mode: host
  devices:
    - "/dev/dri:/dev/dri"
  volumes:
    - ${REPO_PATH}:/ros2:rw
    - ${REPO_PATH}/.devcontainer/.bash_history:/.bash_history:rw
    - /tmp/.X11-unix:/tmp/.X11-unix:rw
    - /dev:/dev:rw
    - /run/udev:/run/udev:ro
  cap_add:
    - SYS_NICE
    - SYS_RAWIO
  ulimits:
    rtprio: 99
    rttime: -1
    memlock: 8428281856
  device_cgroup_rules:
    - "c 188:* rmw"
  environment:
    - DISPLAY=${DISPLAY}
    - QT_X11_NO_MITSHM=1
  stdin_open: true
  tty: true
  user: "${HOST_UID}:${HOST_GID}"
  command: bash

services:
  hz:
    <<: *common-parameters
    container_name: hz
    depends_on:
      - publisher
    command: ["ros2", "topic", "hz", "/test"]

  publisher:
    <<: *common-parameters
    container_name: publisher
    command: ["ros2", "topic", "pub", "/test", "std_msgs/msg/String", "data: 'Hello'"]

```

📌 Key Notes

x-common-parameters defines shared settings for all ROS services.
Each service inherits the common settings.
Use depends_on to control launch priority (i.e., one service starts before another).


## 📝 Step 3: Launch Services with `compose_manager`

Use the `compose_manager` script to manage your ROS services. This is part of [tl_startup](https://github.com/touchlab-avatarx/tl_startup). Run the command with `-h` to see available commands and parameters.

Example:
```
cd <my_launcher_path>
compose_manager start
# ...
compose_manager stop
```

From any directory:
```
compose_manager --work-path <my_launcher_path> start
# ...
compose_manager --work-path <my_launcher_path> stop
```

